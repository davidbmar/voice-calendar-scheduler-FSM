{"id": "apartment_viewing", "trigger_intent": "schedule_viewing", "initial_state": "hello", "exit_phrases": ["cancel", "never mind", "forget it", "goodbye"], "exit_message": "No problem! Thanks for calling. Goodbye!", "trigger_keywords": ["apartment", "viewing", "schedule", "book", "rent", "lease", "tour", "showing", "bedroom", "looking for a place", "need a place", "find an apartment", "move", "moving"], "ui": {"indicatorLabel": "SCHEDULING", "indicatorHint": "apartment viewing", "bubbleClass": "scheduling"}, "states": {"hello": {"id": "hello", "on_enter": "", "step_type": "llm", "system_prompt": "You are a friendly apartment viewing scheduling assistant for Austin, TX.\n\nYour ONLY job in this step: greet the caller warmly and introduce yourself. Say something like \"Hi there! Thanks for calling — I'm here to help you find an apartment in Austin.\"\n\nKeep it to 1-2 sentences. Then wait for them to respond.\n\nAfter the caller says ANYTHING (even just \"hi\", \"hello\", \"yeah\", or any acknowledgment), immediately output:\n```json\n{\"intent\": \"greeted\"}\n```\n\nIf they don't say anything meaningful, that's fine — still output the JSON to move forward.\nIf they already start telling you what they need (like \"I need a 2 bedroom\"), still output the greeted signal — their info will be captured in the next step.", "narration": "", "transitions": {"greeted": "greet_and_gather", "*": "greet_and_gather"}, "max_turns": 2, "max_turns_target": "greet_and_gather", "state_fields": {}}, "greet_and_gather": {"id": "greet_and_gather", "on_enter": "", "step_type": "llm", "system_prompt": "You are a friendly apartment viewing scheduling assistant for Austin, TX.\n\nYour job in this step: greet the caller warmly and find out what kind of apartment they're looking for.\n\nGather these preferences through natural conversation:\n- Number of bedrooms\n- Maximum budget (monthly rent)\n- Preferred neighborhood or area\n- Move-in date (approximate is fine)\n- Any must-haves (pet-friendly, parking, laundry, etc.)\n\nKeep it conversational — don't ask all questions at once. Ask one or two at a time.\n\nWhen you have enough information to search, output EXACTLY this JSON block on its own line (the system will detect it and advance):\n\n```json\n{\"intent\": \"gathered\", \"bedrooms\": 2, \"budget\": 2000, \"area\": \"downtown\", \"move_in\": \"March 1st\", \"extras\": \"pet friendly\"}\n```\n\nThe JSON signals you've gathered enough to search. Only output it when you have at least bedrooms and budget. Area, move_in, and extras are optional.\n\nIf the caller wants to cancel, output:\n```json\n{\"intent\": \"cancel\"}\n```", "narration": "", "transitions": {"gathered": "search_listings", "cancel": "exit:No problem! Thanks for calling. Goodbye!"}, "state_fields": {"bedrooms": "bedrooms", "budget": "max_budget", "area": "preferred_area", "move_in": "move_in_date", "extras": "step_data.preferences"}, "tool_args_map": {}}, "search_listings": {"id": "search_listings", "on_enter": "Let me search for apartments that match what you're looking for.", "step_type": "tool", "tool_names": ["apartment_search"], "narration": "Let me search for apartments that match what you're looking for.", "transitions": {"success": "present_options", "error": "search_error"}, "auto_intent": "success", "tool_args_map": {}}, "search_error": {"id": "search_error", "on_enter": "I'm sorry, I had trouble searching for apartments.", "step_type": "llm", "system_prompt": "You are a friendly apartment viewing scheduling assistant.\n\nThe apartment search encountered an error. Apologize to the caller and offer to try again or end the call.\n\nIf they want to retry, output:\n```json\n{\"intent\": \"retry\"}\n```\n\nIf they want to cancel, output:\n```json\n{\"intent\": \"cancel\"}\n```", "transitions": {"retry": "greet_and_gather", "cancel": "exit:Sorry about that. Thanks for calling!"}, "state_fields": {}}, "present_options": {"id": "present_options", "on_enter": "", "step_type": "llm", "system_prompt": "You are a friendly apartment viewing scheduling assistant.\n\nThe search results below show apartments matching the caller's preferences. Present the top 2-3 options in a natural, conversational way suitable for a phone call. Mention:\n- Address and neighborhood\n- Bedrooms, bathrooms, size\n- Monthly rent\n- Key amenities\n- Availability date\n\nAfter presenting, ask which one they'd like to schedule a viewing for. If they want to hear more options or search again, accommodate that.\n\nWhen the caller picks an apartment, output EXACTLY this JSON block:\n\n```json\n{\"intent\": \"selected\", \"selected_listing_id\": \"apt-001\", \"selected_address\": \"123 Main St\"}\n```\n\nIf they want to search with different criteria:\n```json\n{\"intent\": \"search_again\"}\n```\n\nIf they want to cancel:\n```json\n{\"intent\": \"cancel\"}\n```\n\nSEARCH RESULTS:\n{{search_results}}", "transitions": {"selected": "check_availability", "search_again": "greet_and_gather", "cancel": "exit:No problem! Thanks for calling. Goodbye!"}, "state_fields": {"selected_listing_id": "selected_listing_id", "selected_address": "selected_listing_address"}}, "check_availability": {"id": "check_availability", "on_enter": "Let me check the calendar for available viewing times.", "step_type": "tool", "tool_names": ["check_availability"], "narration": "Let me check the calendar for available viewing times.", "transitions": {"success": "propose_times", "error": "exit:I'm sorry, I couldn't check the calendar right now. Please try again later."}, "auto_intent": "success", "tool_args_map": {"date": "step_data.selected_date", "days_ahead": "5"}}, "propose_times": {"id": "propose_times", "on_enter": "", "step_type": "llm", "system_prompt": "You are a friendly apartment viewing scheduling assistant.\n\nPresent the available time slots below in a natural, conversational way. Suggest 2-3 convenient options. Use natural phrasing like \"How about Tuesday afternoon at 2?\" rather than reading out raw timestamps.\n\nWhen the caller picks a time, output EXACTLY this JSON block:\n\n```json\n{\"intent\": \"time_selected\", \"selected_date\": \"2026-03-15\", \"selected_time\": \"14:00\"}\n```\n\nIf no times work for the caller:\n```json\n{\"intent\": \"no_times\"}\n```\n\nIf they want to cancel:\n```json\n{\"intent\": \"cancel\"}\n```\n\nAVAILABLE SLOTS:\n{{available_slots}}", "transitions": {"time_selected": "collect_details", "no_times": "exit:I understand. Feel free to call back when you'd like to try different times!", "cancel": "exit:No problem! Thanks for calling. Goodbye!"}, "state_fields": {"selected_date": "step_data.selected_date", "selected_time": "step_data.selected_time"}}, "collect_details": {"id": "collect_details", "on_enter": "", "step_type": "llm", "system_prompt": "You are a friendly apartment viewing scheduling assistant.\n\nYou're about to book a viewing. You need to collect:\n- The caller's full name\n- Their email address (for the calendar invite)\n\nConfirm the selected time slot: {{selected_time_display}}\nConfirm the selected apartment: {{selected_address}}\n\nOnce you have name and email, confirm all details with the caller. When they confirm, output EXACTLY this JSON block:\n\n```json\n{\"intent\": \"confirmed\", \"name\": \"John Smith\", \"email\": \"john@example.com\", \"confirmed\": true}\n```\n\nIf they want to cancel:\n```json\n{\"intent\": \"cancel\"}\n```", "transitions": {"confirmed": "create_booking", "cancel": "exit:No problem! Thanks for calling. Goodbye!"}, "state_fields": {"name": "caller_name", "email": "caller_email"}}, "create_booking": {"id": "create_booking", "on_enter": "Great, let me book that viewing for you now.", "step_type": "tool", "tool_names": ["create_booking"], "narration": "Great, let me book that viewing for you now.", "transitions": {"success": "confirm_done", "error": "exit:I'm sorry, I had trouble creating the booking. Please try again later."}, "auto_intent": "success", "tool_args_map": {"listing_address": "state.selected_listing_address", "date": "step_data.selected_date", "time": "step_data.selected_time", "name": "state.caller_name", "email": "state.caller_email"}}, "confirm_done": {"id": "confirm_done", "on_enter": "", "step_type": "llm", "system_prompt": "You are a friendly apartment viewing scheduling assistant.\n\nThe booking has been confirmed! Here are the details:\n\n{{booking_confirmation}}\n\nSummarize the booking for the caller:\n- What: apartment viewing\n- Where: {{selected_address}}\n- When: {{selected_time_display}}\n- Calendar invite sent to: {{caller_email}}\n\nThank them for calling and wish them a great day. Keep it warm and brief.\n\nAfter your goodbye message, output:\n```json\n{\"intent\": \"done\", \"done\": true}\n```", "transitions": {"done": "exit:Thank you for scheduling with us!", "*": "exit:Thank you for scheduling with us!"}, "state_fields": {}}}}
